/*!
 *	                  ....
 *	                .:   '':.
 *	                ::::     ':..
 *	                ::.         ''..
 *	     .:'.. ..':.:::'    . :.   '':.
 *	    :.   ''     ''     '. ::::.. ..:
 *	    ::::.        ..':.. .''':::::  .
 *	    :::::::..    '..::::  :. ::::  :
 *	    ::'':::::::.    ':::.'':.::::  :
 *	    :..   ''::::::....':     ''::  :
 *	    :::::.    ':::::   :     .. '' .
 *	 .''::::::::... ':::.''   ..''  :.''''.
 *	 :..:::'':::::  :::::...:''        :..:
 *	 ::::::. '::::  ::::::::  ..::        .
 *	 ::::::::.::::  ::::::::  :'':.::   .''
 *	 ::: '::::::::.' '':::::  :.' '':  :
 *	 :::   :::::::::..' ::::  ::...'   .
 *	 :::  .::::::::::   ::::  ::::  .:'
 *	  '::'  '':::::::   ::::  : ::  :
 *	            '::::   ::::  :''  .:
 *	             ::::   ::::    ..''
 *	             :::: ..:::: .:''
 *	               ''''  '''''
 *	
 *
 *	AUTOMAD
 *
 *	Copyright (c) 2014 by Marc Anton Dahmen
 *	http://marcdahmen.de
 *
 *	Licensed under the MIT license.
 *	http://automad.org/license
 */
$(document).on("click","#automad-add-variable-button",function(){var c="input-data-",b=$("#automad-add-variable-name").val().replace(/[^\w\.\-]/g,"_").toLowerCase();if($("#"+c+b).length==0){if(b){var a=$('<div class="form-group"><label for="'+c+b+'">'+b.charAt(0).toUpperCase()+b.slice(1)+'</label><button type="button" class="close automad-remove-parent">&times;</button><textarea id="'+c+b+'" class="form-control" name="data['+b+']" rows="10"></textarea></div>').appendTo($("#automad-custom-variables"));$("#automad-add-variable-modal").modal("hide");$("#automad-add-variable-name").val("");a.find("textarea").trigger("keyup")}else{$('<div class="alert alert-danger"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>'+$(this).data("automadErrorName")+"</div>").prependTo($("#automad-add-variable-modal .modal-body"))}}else{$('<div class="alert alert-danger"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>'+$(this).data("automadErrorExists")+"</div>").prependTo($("#automad-add-variable-modal .modal-body"))}});$(document).on("click","#automad-move-page-modal a",function(){var d=$("#automad-move-page-modal"),b=d.find(".modal-body"),c=d.data("automadUrl"),e=d.data("automadTitle"),a=decodeURIComponent($(this).attr("href").split("=")[1]);$.post("?ajax=move_page",{url:c,title:e,destination:a},function(f){if(f.redirect){window.location.href=f.redirect}if(f.error){$('<div class="alert alert-danger alert-dismissable fade in"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>'+f.error+"</div>").prependTo(b)}},"json");return false});$(document).on("click",".automad-remove-parent",function(){$(this).parent().remove()});$(document).on("click",'[data-target="#automad-rename-file-modal"]',function(){var c=$("#automad-rename-file-modal"),b=c.find(".modal-body").empty(),d=$("<input>",{type:"hidden",name:"old-name"}).val($(this).data("file")).appendTo(b),a=$("<input>",{type:"text",name:"new-name","class":"form-control"}).val($(this).data("file")).appendTo(b);c.on("hidden.bs.modal",function(){var e=c.closest("form");b.empty();e.get(0).reset();e.submit()})});$(document).on("click","button#rename-file",function(){var a=$(this).button("loading"),b=$("#automad-rename-file-modal"),c={url:b.data("automadUrl"),"old-name":b.find('[name="old-name"]').val(),"new-name":b.find('[name="new-name"]').val()};$.post("?ajax=rename_file",c,function(d){a.button("reset");if(d.error){b.find(".alert").remove();$('<div class="alert alert-danger alert-dismissable fade in"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>'+d.error+"</div>").prependTo(b.find(".modal-body"))}else{b.modal("hide")}},"json")});$(document).on("click",'[data-target="#automad-upload-modal"]',function(){var h=$($(this).data("target")),a=h.data("automadUrl"),b=h.data("automadDropzoneText"),i=h.data("automadBrowseText"),d=h.find("#automad-upload").html(""),g=$('<div class="dropzone"><div class="text-muted">'+b+"</div></div>").appendTo(d),f=$('<input type="file" multiple />').appendTo(g).hide(),e=$('<button class="btn btn-primary"><span class="glyphicon glyphicon-folder-open"></span> '+i+"</button>").click(function(){f.click();return false}).insertAfter(g),j=h.find('[data-dismiss="modal"]');$(document).on("drop dragover",function(k){k.preventDefault()});function c(k){if(typeof k!=="number"){return""}if(k>=1000000000){return(k/1000000000).toFixed(2)+" gb"}if(k>=1000000){return(k/1000000).toFixed(2)+" mb"}return(k/1000).toFixed(2)+" kb"}f.fileupload({url:"?ajax=upload",dataType:"json",dropZone:g,sequentialUploads:true,singleFileUploads:true,formData:[{name:"url",value:a}],add:function(l,k){var m="";$.each(k.files,function(n){m=m+'<h5><span class="badge">'+c(k.files[n].size)+"</span> "+k.files[n].name+"</h5>"});k.context=$('<div class="box"></div>').appendTo(d);$(m).appendTo(k.context);$('<div class="progress progress-striped active"><div class="progress-bar"></div></div>').appendTo(k.context);k.context.find(".progress-bar").width("0px");k.submit();j.button("loading")},progress:function(m,l){var k=parseInt(l.loaded/l.total*100,10);l.context.find(".progress-bar").text(k+" %").animate({width:k+"%"},120)},stop:function(k){j.button("reset")},done:function(l,k){if(k.result.error){k.context.find(".progress-bar").addClass("progress-bar-warning");k.context.find(".progress").after('<div class="alert alert-warning">'+k.result.error+"</div>")}else{k.context.find(".progress-bar").addClass("progress-bar-success")}k.context.find(".progress").removeClass("progress-striped active")},fail:function(l,k){k.context.find(".progress-bar").text("Error").addClass("progress-bar-danger")}});h.on("hidden.bs.modal",function(k){var l=h.closest("form");l.get(0).reset();l.submit()});h.modal({show:true,backdrop:"static",keyboard:false})});$(document).on("submit",".automad-form",function(f){f.preventDefault();var d=$(this),b=d.find('button[type="submit"]'),c=d.data("automadHandler"),a=d.data("automadUrl"),g=d.serializeArray();if(a){g.push({name:"url",value:a})}b.button("loading");$.post("?ajax="+c,g,function(e){d.parent().find(".alert").remove();if(e.redirect){window.location.href=e.redirect}if(e.html){d.html(e.html)}if(e.error){if(d.parents(".modal-dialog").length!==0){$('<div class="alert alert-danger alert-dismissable fade in"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>'+e.error+"</div>").prependTo(d.find(".modal-body"))}else{$('<div class="alert alert-danger alert-dismissable fade in"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>'+e.error+"</div>").prependTo(d)}}if(e.success){if(d.parents(".modal-dialog").length!==0){$('<div class="alert alert-success alert-dismissable fade in"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>'+e.success+"</div>").prependTo(d.find(".modal-body"))}else{$('<div class="alert alert-success alert-dismissable fade in"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>'+e.success+"</div>").prependTo(d)}}if(!e.error){d.closest(".automad-close-on-success").modal("hide");d.filter(".automad-reset").each(function(){this.reset()})}b.button("reset")},"json")});$(document).ajaxComplete(function(){setTimeout(function(){$('#data [type="submit"], #files [type="submit"], #users [type="submit"]').prop("disabled",true)},100)});$(document).on("change click drop","#data input, #data textarea, #data select, #data button",function(){$('#data [type="submit"]').prop("disabled",false)});$(document).on("change","#files .box input, #users input",function(){$('#files [type="submit"], #users [type="submit"]').prop("disabled",false)});$(document).ready(function(){$(".automad-init").trigger("submit");$(".modal").on("show.bs.modal",function(a){$(this).find(".automad-init").submit()})});$(document).ready(function(){$(".scroll").mCustomScrollbar({scrollbarPosition:"outside",theme:"minimal-dark",autoHideScrollbar:true,scrollInertia:300,scrollButtons:{enable:false}});setTimeout(function(){var a=$(".column.nav li.active");if((a.offset().top+80)>$(window).height()){$(".column.nav .scroll").mCustomScrollbar("scrollTo",function(){return a.offset().top-$(window).height()+80},{scrollInertia:150})}},100)});$(document).ready(function(){var a=$(".column.nav .pages");a.find("li li").has("ul").each(function(){var d=$(this),c=d.children("ul"),b=$('<a href="#" class="expand"><span class="glyphicon"></span></a>').prependTo(d);if(d.hasClass("active")||d.find(".active").length>0){b.children(".glyphicon").addClass("glyphicon-minus-sign")}else{b.children(".glyphicon").addClass("glyphicon-plus-sign");c.hide()}b.click(function(f){f.preventDefault();c.toggle();b.children(".glyphicon").toggleClass("glyphicon-plus-sign glyphicon-minus-sign")})})});function getStatus(){$(".automad-status").each(function(){var a=$(this),b=a.data("automadStatus");$.post("?ajax=status",{item:b},function(c){a.html(c.status)},"json")})}$(document).ready(function(){getStatus()});$(document).ajaxComplete(function(b,c,a){if(a.url!="?ajax=status"){getStatus()}});$(document).on("keyup","textarea:visible",function(){var a=$(this),b=a.val().replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br />"),c=$("<div></div>").appendTo("body").hide().width(a.width()).html(b+" ").css({"white-space":"pre-wrap","word-wrap":"break-word","overflow-wrap":"break-word","font-family":a.css("font-family"),"font-size":a.css("font-size"),"line-height":a.css("line-height"),"letter-spacing":a.css("letter-spacing")});a.height(c.height());c.remove()});$(document).on("drop","textarea:visible",function(){setTimeout(function(){$("textarea").trigger("keyup")},50)});$(document).ajaxComplete(function(){$("textarea").trigger("keyup")});$(window).resize(function(){$("textarea").trigger("keyup")});$(document).on("keydown","textarea",function(c){if(c.keyCode===9){var d=this.selectionStart,a=this.selectionEnd,b=$(this).val();$(this).val(b.substring(0,d)+"\t"+b.substring(a));this.selectionStart=this.selectionEnd=d+1;c.preventDefault()}});$(document).ready(function(){$("#noscript").remove();$("#script").removeClass("hidden")});